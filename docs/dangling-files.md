<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/dangling-files.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Dangling snapshot files

A dangling snapshot file are when a `.verified.` file exist with no corresponding test. This can occur when a test, with corresponding test snapshot file(s), is renamed or deleted. The snapshot file are now redundant and noise on the file system and in the solution explorer


## How dangling snapshot checks works

 * When each test is executed, any snapshots produced are recorded.
 * After all tests are executed, all recorded snapshots are checked against the snapshots that exist on disk
 * An exception is thrown if any files:
   * exist on disk and do not have a corresponding recorded test
   * have casing that does not match the test case


## Experimental

`DanglingSnapshots` is an experimental feature (marked with `[Experimental("VerifyDanglingSnapshots")]`) and is subject to change in minor version.

To use it requires the  `VerifyDanglingSnapshots` warning to to be disabled using a `pragma warning disable`:

```
#pragma warning disable VerifyDanglingSnapshots
```


## Only in CI

When running tests locally, it is not possible to detect if all tests are being run, or only a subset. As such `DanglingSnapshots.Run()` will only perform checks when executed on a build server.


## Usage

In the tear-down of a test run (after all test have run), call `DanglingSnapshots.Run()`.


### MSTest

Use the `[AssemblyCleanup]` feature:

<!-- snippet: DanglingSnapshotsMSTestUsage/DanglingSnapshots.cs -->
<a id='snippet-DanglingSnapshotsMSTestUsage/DanglingSnapshots.cs'></a>
```cs
#pragma warning disable VerifyDanglingSnapshots
[TestClass]
public static class Cleanup
{
    [AssemblyCleanup]
    public static void Run() =>
        DanglingSnapshots.Run();
}
```
<sup><a href='/src/DanglingSnapshotsMSTestUsage/DanglingSnapshots.cs#L1-L8' title='Snippet source file'>snippet source</a> | <a href='#snippet-DanglingSnapshotsMSTestUsage/DanglingSnapshots.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### NUnit

use the `[OneTimeTearDown]` feature:

<!-- snippet: DanglingSnapshotsNUnitUsage/DanglingSnapshots.cs -->
<a id='snippet-DanglingSnapshotsNUnitUsage/DanglingSnapshots.cs'></a>
```cs
#pragma warning disable VerifyDanglingSnapshots

[SetUpFixture]
public static class SetUp
{
    [OneTimeTearDown]
    public static void Run() =>
        DanglingSnapshots.Run();
}
```
<sup><a href='/src/DanglingSnapshotsNUnitUsage/DanglingSnapshots.cs#L1-L9' title='Snippet source file'>snippet source</a> | <a href='#snippet-DanglingSnapshotsNUnitUsage/DanglingSnapshots.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### XUnit

Define an XUnit collection:

<!-- snippet: DanglingSnapshotsXUnitUsage/DanglingSnapshots.cs -->
<a id='snippet-DanglingSnapshotsXUnitUsage/DanglingSnapshots.cs'></a>
```cs
#pragma warning disable VerifyDanglingSnapshots

[CollectionDefinition(nameof(SharedFixtureCollection))]
public class SharedFixtureCollection :
    ICollectionFixture<SharedFixture>;

public sealed class SharedFixture :
    IDisposable
{
    public void Dispose() =>
        DanglingSnapshots.Run();
}
```
<sup><a href='/src/DanglingSnapshotsXunitUsage/DanglingSnapshots.cs#L1-L12' title='Snippet source file'>snippet source</a> | <a href='#snippet-DanglingSnapshotsXUnitUsage/DanglingSnapshots.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Apply that collection to all tests:

<!-- snippet: XunitDanglingCollection -->
<a id='snippet-XunitDanglingCollection'></a>
```cs
[Collection(nameof(SharedFixtureCollection))]
public class Tests
{
    [Fact]
    public Task Simple() =>
        Verify("Foo");
```
<sup><a href='/src/DanglingSnapshotsXunitUsage/Tests.cs#L1-L8' title='Snippet source file'>snippet source</a> | <a href='#snippet-XunitDanglingCollection' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### XUnitV3

Define an XUnit collection:

<!-- snippet: DanglingSnapshotsXUnitV3Usage/DanglingSnapshots.cs -->
<a id='snippet-DanglingSnapshotsXUnitV3Usage/DanglingSnapshots.cs'></a>
```cs
#pragma warning disable VerifyDanglingSnapshots

[CollectionDefinition(nameof(SharedFixtureCollection))]
public class SharedFixtureCollection :
    ICollectionFixture<SharedFixture>;

public sealed class SharedFixture :
    IDisposable
{
    public void Dispose() =>
        DanglingSnapshots.Run();
}
```
<sup><a href='/src/DanglingSnapshotsXunitV3Usage/DanglingSnapshots.cs#L1-L12' title='Snippet source file'>snippet source</a> | <a href='#snippet-DanglingSnapshotsXUnitV3Usage/DanglingSnapshots.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Apply that collection to all tests:

<!-- snippet: XunitV3DanglingCollection -->
<a id='snippet-XunitV3DanglingCollection'></a>
```cs
[Collection(nameof(SharedFixtureCollection))]
public class Tests
{
    [Fact]
    public Task Simple() =>
        Verify("Foo");
```
<sup><a href='/src/DanglingSnapshotsXunitV3Usage/Tests.cs#L1-L8' title='Snippet source file'>snippet source</a> | <a href='#snippet-XunitV3DanglingCollection' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->
